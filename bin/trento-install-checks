#!/bin/sh
#
#  trento-install-checks
#
#  This script installs the checks into the directory Wanda expects them.  It
#  is required, for Kubernetes style sidecar containers and should not be used
#  in regular deployments using docker
#

checks_src="/usr/src/trento-checks/checks"
checks_dst="/usr/share/trento/checks"

mkdir -p "$checks_dst"

if [ -n "$(find "$checks_dst" -maxdepth 0 -type d -empty 2>/dev/null)" ]; then
  if [ ! -d "$checks_src" ]; then
    echo "Make sure the checks are available at $checks_src" 1>&2

    # FIXME: handle via trap
    unset checks_src
    unset checks_dst

    exit 1
  fi

  install -p -m 0644 "$checks_src"/* "$checks_dst"

  # FIXME: handle via trap
  unset checks_src
  unset checks_dst

  exit $?
fi

echo "Make sure $checks_dst is empty and accessible" 1>&2

# FIXME: handle via trap
unset checks_src
unset checks_dst

exit 1
